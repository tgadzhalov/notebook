<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Assignment - School Notebook</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="icon" href="data:,">
    <style>
        .assignment-page {
            max-width: 900px;
            margin: 0 auto;
            padding: 48px 16px 72px;
        }

        .form-shell {
            background: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 18px 40px -30px rgba(37, 99, 235, 0.4);
        }

        .form-header {
            text-align: center;
            margin-bottom: 26px;
        }

        .form-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 12px;
        }

        .form-header p {
            margin: 0;
            font-size: 15px;
            color: #4b5563;
            line-height: 1.6;
        }

        .status-banner {
            display: none;
            margin-bottom: 24px;
            padding: 14px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
        }

        .status-banner.success {
            display: block;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            color: #047857;
        }

        .status-banner.error {
            display: block;
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #b91c1c;
        }

        .assignment-form {
            display: grid;
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-row {
            display: grid;
            gap: 22px;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }

        .form-label {
            text-transform: uppercase;
            letter-spacing: 0.14em;
            font-size: 11px;
            font-weight: 600;
            color: #475569;
        }

        .form-input,
        .form-select,
        .form-textarea {
            border-radius: 12px;
            border: 1px solid #c7d2fe;
            background: #e0e7ff;
            color: #1f2937;
            padding: 13px 16px;
            font-size: 14px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
            background: #ffffff;
        }

        .form-textarea {
            min-height: 160px;
            resize: vertical;
        }

        .field-hint {
            font-size: 12px;
            color: #6b7280;
        }

        .field-error {
            font-size: 12px;
            color: #b91c1c;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .btn-primary {
            background: #2563eb;
            color: #ffffff;
            border: none;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #e0e7ff;
            color: #1e3a8a;
            border: none;
        }

        .btn-secondary:hover {
            background: #c7d2fe;
        }

        @media (max-width: 768px) {
            .assignment-page {
                padding: 32px 16px 56px;
            }

            .form-shell {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="logo" aria-hidden="true">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="5" y="3" width="12" height="18" rx="2.5" fill="#ffffff" stroke="#2563eb"/>
                        <path d="M8 7H14" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M8 11H14" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M8 15H12" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M17 3V19" stroke="#2563eb" stroke-width="1.5"/>
                    </svg>
                </div>
                <span class="brand-text">School Notebook</span>
            </div>

            <div class="nav-menu">
                <a href="/teacher/home" class="nav-link">Home</a>
                <a href="/teacher/students" class="nav-link">Classes</a>
                <a href="/teacher/assignments" class="nav-link active">Assignments</a>
                <a href="/teacher/grades" class="nav-link">Grades</a>
                <a href="/teacher/attendance" class="nav-link">Attendance</a>
            </div>

            <div class="nav-user" th:if="${user != null}">
                <div class="user-avatar">
                    <span class="avatar-text" th:text="${#strings.substring(user.firstName, 0, 1) + #strings.substring(user.lastName, 0, 1)}">TT</span>
                </div>
                <div class="user-info">
                    <span class="user-name" th:text="${user.firstName + ' ' + user.lastName}">Teacher Name</span>
                    <span class="user-role" th:text="${user.userType.displayType}">Teacher</span>
                </div>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn-logout">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Logout</span>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <main class="assignment-page">
        <div class="form-shell">
            <div class="form-header">
                <h1>Publish a new assignment</h1>
                <p>Outline the work, set expectations, and hand it off knowing the details match your classroom cadence.</p>
            </div>

            <div th:if="${successMessage != null}" class="status-banner success" th:text="${successMessage}"></div>
            <div th:if="${errorMessage != null}" class="status-banner error" th:text="${errorMessage}"></div>
            <div th:if="${errors != null}" class="status-banner error">
                <p th:each="err : ${errors.globalErrors}" th:text="${err.defaultMessage}"></p>
            </div>

            <form class="assignment-form"
                  th:action="@{/teacher/assignments}"
                  method="post"
                  novalidate>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div th:object="${assignmentForm}">
                    <div class="form-group">
                        <label class="form-label" for="courseId">Class</label>
                        <select id="courseId" name="courseId" class="form-select" th:value="${assignmentForm.courseId}" required>
                            <option value="" disabled th:selected="${assignmentForm.courseId} == null">Select a class...</option>
                            <option th:each="course : ${courses}"
                                    th:value="${course.id}"
                                    th:text="${course.name}"
                                    th:selected="${assignmentForm.courseId != null and assignmentForm.courseId.equals(course.id)}">
                            </option>
                        </select>
                        <span class="field-hint">Pick the group that will receive this brief.</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="title">Assignment title</label>
                        <input type="text"
                               id="title"
                               name="title"
                               class="form-input"
                               placeholder="e.g. Resonance Lab Reflection"
                               th:value="${assignmentForm.title}"
                               minlength="2"
                               maxlength="100"
                               required>
                        <span class="field-hint">Aim for a headline your students will instantly recognise.</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="description">Intent & deliverables</label>
                        <textarea id="description"
                                  name="description"
                                  class="form-textarea"
                                  placeholder="Describe the why, the how, and what a strong submission looks like."
                                  th:text="${assignmentForm.description}"
                                  maxlength="500"></textarea>
                        <span class="field-hint">Optional, but a short narrative keeps questions to a minimum.</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="assignmentType">Assignment type</label>
                            <select id="assignmentType"
                                    name="assignmentType"
                                    class="form-select"
                                    th:value="${assignmentForm.assignmentType}"
                                    required>
                                <option value="" disabled th:selected="${assignmentForm.assignmentType} == null">Select type...</option>
                                <option th:each="type : ${assignmentTypes}"
                                        th:value="${type.name()}"
                                        th:text="${type.displayType}"
                                        th:selected="${assignmentForm.assignmentType != null and assignmentForm.assignmentType == type}">
                                </option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="dueDate">Due date</label>
                            <input type="date"
                                   id="dueDate"
                                   name="dueDate"
                                   class="form-input"
                                   th:value="${assignmentForm.dueDate}"
                                   required>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="reset" class="btn btn-secondary">Start over</button>
                    <button type="submit" class="btn btn-primary">Publish assignment</button>
                </div>
            </form>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('assignmentForm');
            const message = document.getElementById('assignmentMessage');

            if (!form || !message) {
                return;
            }

            const showMessage = (text, type) => {
                message.textContent = text;
                message.classList.remove('success', 'error');
                if (type) {
                    message.classList.add(type);
                    message.style.display = 'block';
                } else {
                    message.style.display = 'none';
                }
            };

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                showMessage('', null);

                const courseIdField = form.querySelector('[name="courseId"]');
                const titleField = form.querySelector('[name="title"]');
                const descriptionField = form.querySelector('[name="description"]');
                const assignmentTypeField = form.querySelector('[name="assignmentType"]');
                const dueDateField = form.querySelector('[name="dueDate"]');

                const payload = {
                    courseId: courseIdField ? courseIdField.value : null,
                    title: titleField ? titleField.value.trim() : '',
                    description: descriptionField ? descriptionField.value.trim() : '',
                    assignmentType: assignmentTypeField ? assignmentTypeField.value : null,
                    dueDate: dueDateField ? dueDateField.value : null
                };

                try {
                    const response = await fetch('/api/v1/teacher/assignments', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.success) {
                        form.reset();
                        showMessage(result.message || 'Assignment published successfully.', 'success');
                    } else {
                        throw new Error(result.message || 'Unable to publish assignment.');
                    }
                } catch (error) {
                    showMessage(error.message, 'error');
                }
            });
        });
    </script>
</body>
</html>

